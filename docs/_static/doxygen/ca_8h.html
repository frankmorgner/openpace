<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenPACE: eac/ca.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenPACE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2beb2c8fad66f6564e9cdda73fb11327.html">eac</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ca.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Interface for Chip Authentication.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="eac_8h_source.html">eac.h</a>&quot;</code><br />
<code>#include &lt;openssl/buffer.h&gt;</code><br />
</div>
<p><a href="ca_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5766da26877961a967490cb6de6901bb"><td class="memItemLeft" align="right" valign="top"><a id="a5766da26877961a967490cb6de6901bb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ca_8h.html#a5766da26877961a967490cb6de6901bb">CA_FLAG_DISABLE_PASSIVE_AUTH</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a5766da26877961a967490cb6de6901bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Skip the passive authentication. <br /></td></tr>
<tr class="separator:a5766da26877961a967490cb6de6901bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga28c1d11845924a1cd08461c6a1a765cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__management.html#ga28c1d11845924a1cd08461c6a1a765cc">CA_disable_passive_authentication</a> (<a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx)</td></tr>
<tr class="memdesc:ga28c1d11845924a1cd08461c6a1a765cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable passive authentication for this EAC_CTX.  <a href="group__management.html#ga28c1d11845924a1cd08461c6a1a765cc">More...</a><br /></td></tr>
<tr class="separator:ga28c1d11845924a1cd08461c6a1a765cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5819e0a4b3b321e69ebd21661ee84134"><td class="memItemLeft" align="right" valign="top">BUF_MEM *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ca_8h.html#a5819e0a4b3b321e69ebd21661ee84134">CA_get_pubkey</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const unsigned char *ef_cardsecurity, size_t ef_cardsecurity_len)</td></tr>
<tr class="memdesc:a5819e0a4b3b321e69ebd21661ee84134"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the public key from a EF.CardSecurity file.  <a href="ca_8h.html#a5819e0a4b3b321e69ebd21661ee84134">More...</a><br /></td></tr>
<tr class="separator:a5819e0a4b3b321e69ebd21661ee84134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac91aa5d0a95c6c52ffe98192e63614e9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ca_8h.html#ac91aa5d0a95c6c52ffe98192e63614e9">CA_set_key</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const unsigned char *priv, size_t priv_len, const unsigned char *pub, size_t pub_len)</td></tr>
<tr class="memdesc:ac91aa5d0a95c6c52ffe98192e63614e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the CA context with keys.  <a href="ca_8h.html#ac91aa5d0a95c6c52ffe98192e63614e9">More...</a><br /></td></tr>
<tr class="separator:ac91aa5d0a95c6c52ffe98192e63614e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdf162f33faea84cb7ff359bb1d5c09d"><td class="memItemLeft" align="right" valign="top">BUF_MEM *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#gafdf162f33faea84cb7ff359bb1d5c09d">CA_STEP1_get_pubkey</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx)</td></tr>
<tr class="memdesc:gafdf162f33faea84cb7ff359bb1d5c09d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the PICC's encoded public key.  <a href="group__caproto.html#gafdf162f33faea84cb7ff359bb1d5c09d">More...</a><br /></td></tr>
<tr class="separator:gafdf162f33faea84cb7ff359bb1d5c09d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad2aaec726b132e27f50aaa16bfbde574"><td class="memItemLeft" align="right" valign="top">BUF_MEM *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#gad2aaec726b132e27f50aaa16bfbde574">CA_STEP2_get_eph_pubkey</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx)</td></tr>
<tr class="memdesc:gad2aaec726b132e27f50aaa16bfbde574"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the PCD's ephemeral public key (generated in TA step 3)  <a href="group__caproto.html#gad2aaec726b132e27f50aaa16bfbde574">More...</a><br /></td></tr>
<tr class="separator:gad2aaec726b132e27f50aaa16bfbde574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6f5f7dfc8323a946fec506956018525a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#ga6f5f7dfc8323a946fec506956018525a">CA_STEP3_check_pcd_pubkey</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const BUF_MEM *comp_pubkey, const BUF_MEM *pubkey)</td></tr>
<tr class="memdesc:ga6f5f7dfc8323a946fec506956018525a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the public key matches the compressed public key previously received in TA.  <a href="group__caproto.html#ga6f5f7dfc8323a946fec506956018525a">More...</a><br /></td></tr>
<tr class="separator:ga6f5f7dfc8323a946fec506956018525a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5ebe4465cab901c4bb94a75c74bf71fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#ga5ebe4465cab901c4bb94a75c74bf71fa">CA_STEP4_compute_shared_secret</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const BUF_MEM *pubkey)</td></tr>
<tr class="memdesc:ga5ebe4465cab901c4bb94a75c74bf71fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute the shared secret using the PICC's static key pair and the PCD's ephemeral key pair.  <a href="group__caproto.html#ga5ebe4465cab901c4bb94a75c74bf71fa">More...</a><br /></td></tr>
<tr class="separator:ga5ebe4465cab901c4bb94a75c74bf71fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga37bfdcc37ae95d411b5919cdd02fa3bf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#ga37bfdcc37ae95d411b5919cdd02fa3bf">CA_STEP5_derive_keys</a> (const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const BUF_MEM *pub, BUF_MEM **nonce, BUF_MEM **token)</td></tr>
<tr class="memdesc:ga37bfdcc37ae95d411b5919cdd02fa3bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Derives the PICC's encryption and authentication keys.  <a href="group__caproto.html#ga37bfdcc37ae95d411b5919cdd02fa3bf">More...</a><br /></td></tr>
<tr class="separator:ga37bfdcc37ae95d411b5919cdd02fa3bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga34352b58c89ce58c4e3e425bfb20ef45"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__caproto.html#ga34352b58c89ce58c4e3e425bfb20ef45">CA_STEP6_derive_keys</a> (<a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *ctx, const BUF_MEM *nonce, const BUF_MEM *token)</td></tr>
<tr class="memdesc:ga34352b58c89ce58c4e3e425bfb20ef45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Derives the PCD's encryption and authentication keys.  <a href="group__caproto.html#ga34352b58c89ce58c4e3e425bfb20ef45">More...</a><br /></td></tr>
<tr class="separator:ga34352b58c89ce58c4e3e425bfb20ef45"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interface for Chip Authentication. </p>
<p>Chip Authentication (CA) is a protocol which is used to check the authenticity of a MRTD chip and establish a secure channel for further communication. The chip contains one or more key pairs used for key agreement. After successful key agreement symmetric keys are derived from the shared secret. OpenPACE implements CA version 2.</p>
<dl class="section author"><dt>Author</dt><dd>Frank Morgner <a href="#" onclick="location.href='mai'+'lto:'+'fra'+'nk'+'mor'+'gn'+'er@'+'gm'+'ail'+'.c'+'om'; return false;">frank<span style="display: none;">.nosp@m.</span>morg<span style="display: none;">.nosp@m.</span>ner@g<span style="display: none;">.nosp@m.</span>mail<span style="display: none;">.nosp@m.</span>.com</a> </dd>
<dd>
Dominik Oepen <a href="#" onclick="location.href='mai'+'lto:'+'oep'+'en'+'@in'+'fo'+'rma'+'ti'+'k.h'+'u-'+'ber'+'li'+'n.d'+'e'; return false;">oepen<span style="display: none;">.nosp@m.</span>@inf<span style="display: none;">.nosp@m.</span>ormat<span style="display: none;">.nosp@m.</span>ik.h<span style="display: none;">.nosp@m.</span>u-ber<span style="display: none;">.nosp@m.</span>lin.<span style="display: none;">.nosp@m.</span>de</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="ca_8h_source.html">ca.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a5819e0a4b3b321e69ebd21661ee84134"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5819e0a4b3b321e69ebd21661ee84134">&#9670;&nbsp;</a></span>CA_get_pubkey()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BUF_MEM* CA_get_pubkey </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>ef_cardsecurity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>ef_cardsecurity_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract the public key from a EF.CardSecurity file. </p>
<p>Perform passive authentication if required.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>EAC context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ef_cardsecurity</td><td>buffer containing the ASN.1 encoded EF.CardSecurity </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ef_cardsecurity_len</td><td>length of <em>ef_cardsecurity</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The public key or NULL in case of an error </dd></dl>

</div>
</div>
<a id="ac91aa5d0a95c6c52ffe98192e63614e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac91aa5d0a95c6c52ffe98192e63614e9">&#9670;&nbsp;</a></span>CA_set_key()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CA_set_key </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="eac_8h.html#a75c27f2c580e93611f129c121d5125ec">EAC_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>priv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>priv_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>pub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>pub_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the CA context with keys. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>EAC context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">priv</td><td>(optional) Private CA key. Can be an encoded key or a raw point/integer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">priv_len</td><td>Length of <em>priv</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pub</td><td>(optional) Public CA key </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pub_len</td><td>Length of <em>pub</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>See <code>d2i_AutoPrivateKey()</code> for supported encodings of <code>priv</code> </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>1 on success or 0 in case of an error </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
